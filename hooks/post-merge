#!/usr/bin/env bash

HOOK_DIR="$HOME/.sitegeist-hooks"
CHANGED_FILES="$(git diff-tree -r --name-only --no-commit-id ORIG_HEAD HEAD)"

source $HOOK_DIR/utils/stringIncludes

updateNodeDependencies() {
	npm prune && npm install
}
updateComposerDependencies() {
	composer install
}

#
# If a `package.json` file has been changed, execute `npm install` and `npm prune`.
#
if stringIncludes $CHANGED_FILES 'package.json'; then
	updateNodeDependencies
fi

#
# If a `composer.json` file has been changed, execute `composer install`.
#
if stringIncludes $CHANGED_FILES 'composer.json'; then
	updateComposerDependencies
fi

#
# Note: No exit code, this should bubble up from the respective install commands.
#
